## Hostblock config

[Global]

## Log level (ERROR/WARNING/INFO/DEBUG)
## ERROR - write only error messages to syslog
## WARNING - write error and warning messages to syslog
## INFO - write error, warning and info messages to syslog (default)
## DEBUG - write all messages to syslog
log.level = INFO

## Interval for log file check (seconds, default 30)
#log.check.interval = 30

## Needed score to create iptables rule for IP address connection drop (default 10)
#address.block.score = 10

## Score multiplier to calculate time how long iptables rule should be kept (seconds, default 3600, 0 will not remove automatically)
##
## If score == 1:
## 1*3600 - hour
## 1*86400 - day
## 1*432000 - 5 days
## 1*2592000 - 30 days
##
## If score == 4:
## 4*3600 - 4 hours
## 4*86400 - 4 days
## 4*432000 - 20 days
## 4*2592000 - 120 days
#address.block.multiplier = 3600

## Rule to use in IP tables rule (use %i as placeholder to specify IP address)
## Simple rule to drop packets from IP address
iptables.rules.block = -s %i -j DROP
## Or set up new iptables chain separate for hostblock
#iptables.rules.block = -s %i -j HB_LOG_AND_DROP

## TODO Startup rules to check and add if they are missing
## As example to automatically add HB_LOG_AND_DROP rules if host is restarted and rules are not restored with iptables-restore
#iptables.rules.startup = -N HB_LOG_AND_DROP
#iptables.rules.startup = -A HB_LOG_AND_DROP -j LOG --log-prefix "IPTABLES-DROPPED: " --log-level 4
#iptables.rules.startup = -A HB_LOG_AND_DROP -j DROP

## Datetime format (default %Y-%m-%d %H:%M:%S)
#datetime.format = %Y-%m-%d %H:%M:%S

## Datafile location
datafile.path = /usr/local/share/hostblock/hostblock.data

## AbuseIPDB URL
#abuseipdb.api.url = https://www.abuseipdb.com

## AbuseIPDB API Key
#abuseipdb.api.key = AbuseIPDBAPIKeyAbuseIPDBAPIKeyAbuseIPDBA

## AbuseIPDB API date time format
#abuseipdb.datetime.format = %a, %d %b %Y %H:%M:%S

## Whether to report all matches to AbuseIPDB (true|false, default false)
#abuseipdb.report.all = false

## Default categories for reporting to AbuseIPDB (default 15, separated with comma, must have at least one category)
#abuseipdb.report.categories = 15

## Default comment for AbuseIPDB reports
## Use %m to include matched line
## Use %i to include address
#abuseipdb.report.comment = Hostblock (https://github.com/tower9/hostblock)
#abuseipdb.report.comment = %m

## Pattern and log file configuration for OpenSSH
[Log.OpenSSH]

## AbuseIPDB log group level configuration (overrides global setting)
#abuseipdb.report.all = true
#abuseipdb.report.categories = 18,22
#abuseipdb.report.comment = %m

## Full path to log file(s)
## Gentoo/SuSE
#log.path = /var/log/messages
## RedHat/Fedora
#log.path = /var/log/secure
## Mandrake/FreeBSD/OpenBSD
log.path = /var/log/auth.log

## Patterns to match with scores to use for calculation
## Use %i to specify where in pattern IP address should be looked for
## Score must follow after pattern, if not specified by default will be set 1
## If AbuseIPDB reporting is configured (API key specified), then here can also specify individual rules for reporting (overrides global and log group settings)
## - log.abuseipdb.report - whether to report
## - log.abuseipdb.categories - comma separated categories to specify, if not specified then default are used (abuseipdb.report.categories)
## - log.abuseipdb.comment - comment to specify in report, if not specified then comment from log group or global settings is used, to report without comment, specify setting with empty value
log.pattern = ^.+? sshd\[\d+\]: Invalid user \S+ from %i
log.score = 2
log.pattern = ^.+? sshd\[\d+\]: Invalid user \S+ from %i port \d+
log.score = 2
log.pattern = ^.+? sshd\[\d+\]: error: PAM: Authentication failure for \S+ from %i
log.pattern = ^.+? sshd\[\d+\]: ROOT LOGIN REFUSED FROM %i
log.score = 20
log.pattern = ^.+? sshd\[\d+\]: SSH: Server;Ltype: Authname;Remote: %i-\d+;Name: root \[preauth\]
log.score = 20
log.pattern = ^.+? sshd\[\d+\]: Did not receive identification string from %i
log.pattern = ^.+? sshd\[\d+\]: User \S+ from %i not allowed because not listed in AllowUsers
log.score = 2
log.pattern = ^.+? sshd\[\d+\]: pam_unix(sshd:auth): authentication failure; logname= uid=0 euid=0 tty=ssh ruser= rhost=%i
log.pattern = ^.+? sshd\[\d+\]: Postponed keyboard-interactive for invalid user \S+ from %i port \d+ ssh2 \[preauth\]
log.score = 2
log.pattern = ^.+? sshd\[\d+\]: PAM: Authentication failure for illegal user \S+ from %i
log.score = 2
log.pattern = ^.+? sshd\[\d+\]: Failed keyboard-interactive/pam for invalid user \S+ from %i port \d+ ssh2
log.score = 2
log.pattern = ^.+? sshd\[\d+\]: Disconnecting: Too many authentication failures for invalid user \S+ from %i port \d+ ssh2 \[preauth\]
log.score = 2
log.pattern = ^.+? sshd\[\d+\]: Failed password for invalid user \S+ from %i port \d+ ssh2
log.score = 2

## Patterns in log file to count refused connection count
## Use %i to specify where in pattern IP address should be looked for
## Score must follow after pattern, if not specified by default will be set 1
## TODO Add here different patterns for each interesting port and one common? Change pattern matching that if pattern matched for current line, then do not check other patterns?
log.refused.pattern = ^.+? kernel: \[\s?\d+\.\d+\] IPTABLES-DROPPED: .+? SRC=%i .+?
log.refused.score = 5
#log.abuseipdb.report = true
#log.abuseipdb.categories = 15
#log.abuseipdb.comment = Firewall blocked access

## Pattern and log file configuration for Apache
[Log.ApacheAccess]

## AbuseIPDB log group level configuration
#abuseipdb.report = false

## Full path to log file(s)
log.path = /var/log/apache2/access.log

## Patterns to match
## Use %i to specify where in pattern IP address should be looked for
## Score must follow after pattern, if not specified by default will be set 1
## If AbuseIPDB reporting is configured (API key specified), then here can also specify individual rules for reporting (overrides global and log group settings)
## - log.abuseipdb.report - whether to report
## - log.abuseipdb.categories - comma separated categories to specify, if not specified then default are used (abuseipdb.report.categories)
## - log.abuseipdb.comment - comment to specify in report, if not specified then default is used (abuseipdb.report.comment)
log.pattern = ^%i .+?soapcaller\.bs.+?# Morpheus * Scanner
log.score = 20
log.pattern = ^%i .+?hnap1.+?# Dlink routers sometimes return SOAP document with this request (http://forums.dlink.com/index.php?topic=12061.0)
log.score = 10
log.pattern = ^%i .+?fdopen\(.+?
log.score = 5
log.pattern = ^%i .+?allow_url_include.+?
log.score = 2
log.pattern = ^%i .+?passwd.+?
log.score = 2
log.pattern = ^%i .+?%63%67%69%2d%62%69%6e\/%70%68%70\?%2d%64.+?# cgi-bin/php?-d
log.score = 2
log.pattern = ^%i .+?%2d%64\+%61%6c%6c%6f%77%5f%75%72%6c%5f%69%6e%63%6c%75%64%65%3d%6f%6e.+?# -d allow_url_include=on
log.score = 2
log.pattern = ^%i .+?hndUnblock\.cgi.+?# some Cisco/Linksys router firmwares have this binary that has multiple security holes that allow various attacks on the router
log.score = 2
log.pattern = ^%i .+?tmUnblock\.cgi.+?# some Cisco/Linksys router firmwares have this binary that has multiple security holes that allow various attacks on the router
log.score = 2
log.pattern = ^%i .+?\/user\/register\?element_parents\=account\/mail.+?
log.score = 2
log.pattern = ^%i .+?\/GponForm\/diag_Form\?images.+?
log.score = 2
log.pattern =  ^%i .+?/\jmx\-console\/HtmlAdaptor\?action\=inspectMBean\&name\=jboss\.system.+?
log.score = 2
log.pattern = ^%i .+?suhosin.+?
log.pattern = ^%i .+?packets\.txt.+?
log.pattern = ^%i .+?ncsi\.txt.+?
log.pattern = ^%i .+?w00tw00t\.at\.isc\.sans\.dfind.+?
log.pattern = ^%i .+?w00tw00t\.at\.blackhats.+?
log.pattern = ^%i .+?save_zoho\.php.+?
log.pattern = ^%i .+?fork.+?
log.pattern = ^%i .+?savewordtemplate.+?
log.pattern = ^%i .+?nosuichfile.+?
log.pattern = ^%i .+?deletedataset.+?
log.pattern = ^%i .+?axa\.php.+?
log.pattern = ^%i .+?webdav.+?
log.pattern = ^%i .+?muieblackcat.+?
log.pattern = ^%i .+?w19218317418621031041543.+?
#log.pattern = ^%i .+?(phpmy|php\-my|my|web|php|db|database|ldap|phppg)(admin|\-admin|manager|\-manager).+?
#log.abuseipdb.report = true
#log.abuseipdb.categories = 21
#log.abuseipdb.comment = Web application scan, tried accessing phpmyadmin|webadmin|dbadmin|dbmanager which is not installed on this server
#log.pattern = ^%i .+?joomla\/administrator.+?
#log.pattern = ^%i .+?phpinfo.+?
#log.pattern = ^%i .+?sqlweb.+?
#log.pattern = ^%i .+?websql.+?
#log.pattern = ^%i .+?mysqldumper.+?
#log.pattern = ^%i .+?sqlitemanager.+?
#log.pattern = ^%i .+?webdb.+?
#log.pattern = ^%i .+?phppath.+?
#log.pattern = ^%i .+?invoker.+?
#log.pattern = ^%i .+?live_view.+?
#log.pattern = ^%i .+?\.exe.+?
#log.pattern = ^%i .+?bigmir\.net.+?
#log.pattern = ^%i .+?setup\.php.+?
#log.pattern = ^%i .+?cpanelsql.+?
#log.pattern = ^%i .+?zabbix.+?
#log.pattern = ^%i .+?mysql.+?
#log.pattern = ^%i .+?console.+?
#log.pattern = ^%i .+?wp\-login\.php.+?# If wordpress not available, can consider all these also malicious
#log.pattern = ^%i .+?admin\.php.+?
#log.pattern = ^%i .+?enter\.cfm.+?
#log.pattern = ^%i .+?webalizer.+?
#log.pattern = ^%i .+?server\-status.+?
#log.score = 5
#log.pattern = ^%i .+?root.+?
#log.score = 5
#log.pattern = ^%i .+?dexter.+?
#log.pattern = ^%i .+?install.+?


## Pattern and log file configuration for Dovecot
#[Log.Dovecot]

## Full path to log file(s)
#log.path = /var/log/maillog

## Patterns to match
## Use %i to specify where in pattern IP address should be looked for
## Score must follow after pattern, if not specified by default will be set 1
## If AbuseIPDB reporting is configured (API key specified), then here can also specify individual rules for reporting (overrides global and log group settings)
## - log.abuseipdb.report - whether to report
## - log.abuseipdb.categories - comma separated categories to specify, if not specified then default are used (abuseipdb.report.categories)
## - log.abuseipdb.comment - comment to specify in report, if not specified then default is used (abuseipdb.report.comment)
#log.pattern = ^.+? dovecot: pop3-login: Aborted login \(tried to use disallowed plaintext auth\): \S+ rip=%i,.+?
#log.abuseipdb.report = true
#log.abuseipdb.categories = 11,18
